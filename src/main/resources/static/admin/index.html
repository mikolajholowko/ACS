<!DOCTYPE html>
<html lang="pl">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>QR</title>
    <link rel="stylesheet" href="admin/style.css">
</head>
<body>


<div class="containter">
    <div class="navbar">
        <img src="admin/logo.png" alt="logo" class="logo">
        <nav>
            <ul id="menuList">
                <input type="button" id="refresh-qr" onclick="refresh(); window.location.reload();" value="Refresh QR">
                <li><a href="/admin-available-rooms">Dostępne pomieszczenia</a></li>
                <li><a href="/admin-create-account">Utwórz konto</a></li>
                <li><a href="/admin-account-update">Ustawienia konta</a></li>
                <li><a href="/">Wyloguj</a></li>
            </ul>
        </nav>
        <img src="admin/menu.png" alt="menu" class="menuic"
             onclick="togglemenu()">
    </div>
    <div class="row">
        <div class="col-1">
            <h2 id="user-id"></h2>
            <br>
            <h3 id="first-name"></h3>
            <br>
            <h3 id="last-name"></h3>
            <br>
        </div>
        <div class="col-2">
            <img id="qrCode" class="qr">
        </div>
    </div>

</div>

</body>
<script>
        var menuList = document.getElementById("menuList");
        menuList.style.maxHeight = "0px";
        function togglemenu(){
            if(menuList.style.maxHeight == "0px")
            {
                menuList.style.maxHeight = "135px";
            }
            else
            {
                menuList.style.maxHeight = "0px";
            }
        }

        let getEmployeeList = async () => {
            return fetch('auth/employee', {
                method: "GET",
                headers: {'Content-Type': 'application/json'}
            }).then(response => response.json())
            .then(response2 => {
               document.getElementById("user-id").innerText = "ID: " + response2.id;
               document.getElementById("first-name").innerText = "First name: " + response2.firstName;
               document.getElementById("last-name").innerText = "Last name: " + response2.lastName;
               return response2.id;
            })
        }

       getEmployeeList().then(r => {
       const url = "/qr/" + r;
            downloadImage(url);
       });

        const fetchImage = async url => {
            const response = await fetch(url)
            const blob = await response.blob()
            return blob
        }

        const downloadImage = async url => {
            const imageBlob = await fetchImage(url)

            const imageBase64 = URL.createObjectURL(imageBlob)
            document.getElementById("qrCode").src = imageBase64;
        }

        const refresh = () => {
         getEmployeeList().then(id => {
           const url = "/refreshQr/" + id;
           refreshQr(url);
           });
         }

        const refreshQr = async url => {
            const response = await fetch(url)
        }

</script>
</html>